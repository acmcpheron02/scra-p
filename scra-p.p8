pico-8 cartridge // http://www.pico-8.com
version 39
__lua__

#include pancelor_debug.p8
#include func.p8
#include player.p8
#include enemy.p8
#include managers.p8
#include ui.p8

game_states = {title, combat, pick_part}
game_state = nil

--definitions
parti = {"head", "larm", "rarm", "legs", "frame"}

function _init()
    printh("\n\n Fresh Run")
    game_state = title
end

function _update60()
    game_state.state_update();
end

function _draw()
    game_state.state_draw();
end

--title definitions--
title = {}

function title.state_update()
    if btnp(4) then game_state = combat end
end

function title.state_draw()

end

--combat definitions--
combat = {}

function combat.state_update()
    if player.ready then
        if btnp(2) then combat_manager:movecursor('up') end
        if btnp(3) then combat_manager:movecursor('down') end
        if btnp(4) then 
            printh("made it to point a")
            if not combat_manager:selected_part().ready then return end
            combat_manager:add_command(combat_manager:selected_part())
            printh("made it to point b")
            combat_manager:add_cooldown(combat_manager:selected_part())
            printh("made it to point c")
            while player.ready_in > 0 do
                combat_manager:advance()
            end
        end
    end
    if btnp(5) then 
        combat_manager:advance()
        add_elog("manual advance")
    end
    if opponent.ready then
        combat_manager:add_command(opponent_random_action())
        opponent.ready = false
        printh("made it to point d")
    end
end

__gfx__
002200000000022222080220000200002222a920000e000022222220000000000000000000000000000000000000000000000000000000000000000000000000
00222000000ee200208a802000282000200aa9200222220024000a20000000000000000000000000000000000000000000000000000000000000000000000000
000922000ee7e200080a08000088800020aa9020220002200240a200000000000000000000000000000000000000000000000000000000000000000000000000
00222000222222008aa9aa80008880002aa9002020000020002a2000000000000000000000000000000000000000000000000000000000000000000000000000
0022000088888800080a0800008a80002aaaa9202007aa20024a0200000000000000000000000000000000000000000000000000000000000000000000000000
0000000022222200208a8020208a802020aa9020200a0020240aa020000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ee220022080220022a22002aa90020220a022024aaaa20000000000000000000000000000000000000000000000000000000000000000000000000
00000000000e222200000000000a00002a9222200222220022222220000000000000000000000000000000000000000000000000000000000000000000000000
00222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02eed20000a880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2ed000200a8888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d0000200a8888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d000020088888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02000200008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
